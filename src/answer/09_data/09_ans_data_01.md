#  iOS 持久化
iOS 持久化的几种方式：
- NSUserDefaults
- plist
- Keychain（钥匙串）
- NSKeyedArchiver 归档
- Sandbox 沙盒 
- 数据库
- Core Data

## NSUserDefaults
- 主要使用场景：用于存储用户的偏好设置和用户信息,如用户名,是否自动登录,字体大小等.数据自动保存在沙盒的Libarary/Preferences目录下.
- 是否支持自定义对象存储：不支持
- 存储格式：key-value 键值对
- 优点：
  - 使用简单方便；
  - NSUserDefaults 是线程安全的。
- 缺点：
  - 不支持自定义对象的存储；
  - 不安全，NSUserDefaults 是在沙盒下的 Libray/Preferences 目录下创建 .plist 文件, 然后将文件存储在其中。这种存储方式就决定了它的安全性几乎为0,所以不建议存储一些敏感信息如:用户密码,token,加密私钥等!
  - 实效性差：由于 NSUserDefaults 不是即时写入，它会定时把缓存中的数据写入磁盘。一般需要调用 `synchronize` 强制立即将数据写入磁盘.
  - 卸载程序时，数据会被清除。NSUserDefaults保存的数据不会通过iTunes传递到另外的设备也不会存储到iCloud上面。

## plist
全名是 Property List，即属性列表文件，这种文件的扩展名为.plist。
- 主要使用场景：用来存储串行化后的对象的文件，用于存储程序中经常用到且数据量小而不经常改动的数据。
- 是否支持自定义对象存储：不支持
- 优点：易用性强
- 缺点：
  - 不支持自定义对象的存储；如果需要存储自定义类型的数据需要先进行序列化!
  - 不适合操作处理大量数据

## Keychain（钥匙串）
- 主要使用场景：一种安全的存储敏感信息的工具,比如,网络密码:用户访问服务器或者网站,通用密码:用来保存应用程序或者数据库密码.与此同时,用于认证的证书,密钥,和身份信息,也可以存储在Keychain中,Keychain Services 的安全机制保证了存储这些敏感信息不会被窃取。简单说来，Keychain 就是一个安全容器。
- 优点：
  - 数据并不存放在App的Sanbox中，即使删除了App，资料依然保存在keychain中。如果重新安装了app，还可以从keychain获取数据。
  - keychain的数据可以通过group方式，让程序可以在App间共享。不过得要相同TeamID
  - keychain的数据是经过加密的
- 原理：对于每一个应用来说，KeyChain都有两个访问区，私有区和公共区。私有区是一个sandbox，本程序存储的任何数据都对其他程序不可见，其他应用程序无法访问该区数据。如果要想将存储的内容放在公共区，实现多个应用程序间可以共同访问一些数据，则可以先声明公共区的名称，官方文档管这个名称叫“keychain access group”

[iOS Keychain(钥匙串)原理及使用](https://juejin.cn/post/6844903921765318669)

## NSKeyedArchiver 归档
归档是iOS开发中数据存储常用的技巧，归档可以直接将对象储存成文件，把文件读取成对象。
- 主要使用场景：一般用于存储少量数据
- 是否支持自定义对象存储：支持，需要遵循 NSCoding 协议，实现 `initWithCoder:` 和 `encodeWithCoder:` 方法
- 优点：可以将复杂的对象写入文件 可以归档集合类，所以无论添加多少对象，将对象写入磁盘的方式都是一样的，不会增加工作量；

## Sandbox 沙盒 
- 主要使用场景：持久化在Document目录下，一般存储非机密数据。当App中涉及到电子书阅读、听音乐、看视频、刷图片列表等时，推荐使用沙盒存储。
- 沙盒里面一般有4个目录：
  - Documents: 保存应运行时生成的需要持久化的数据,iTunes同步设备时会备份该目录。例如,游戏应用可将游戏存档保存在该目录。
  - Library/Caches: 保存应用运行时成的需要持久化的数据,iTunes同步设备时不会备份 该目录。一般存储体积大、不需要备份的非重要数据，比如网络数据缓存存储到Caches下
  - Library/Preference: 保存应用的所有偏好设置，如iOS的Settings(设置) 应会在该目录中查找应的设置信息。iTunes同步设备时会备份该目录。
  - tmp: 保存应运行时所需的临时数据,使完毕后再将相应的文件从该目录删除。应用 没有运行时,系统也可能会清除该目录下的文件。iTunes同步设备时不会备份该目录。

## 数据库
iOS 中可以使用 sqlite 轻量级数据库。
- 主要使用场景：适合储存数据量较大的数据
- 缺点：易用性不强
- 优点：
  - 可以存储大量数据，存储、检索大量数据非常高效；
  - 能对数据进行复杂的聚合，比使用对象执行这些操作要高效得多。

## Core Data
Core Data是iOS5之后才出现的一个框架，它提供了对象-关系映射(ORM)的功能，即能够将OC对象转化成数据，保存在SQLite数据库文件中，也能够将保存在数据库中的数据还原成OC对象。在此数据操作期间，我们不需要编写任何SQL语句.
- 缺点：CoreData 本质还是将数据存在了SQLite数据库文件 ,使用不是很方便.
- 优点：和 数据库一致，但是不需要写SQL语句。